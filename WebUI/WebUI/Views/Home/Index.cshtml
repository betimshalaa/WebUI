
@{
    ViewData["Title"] = "Map";
}

<div id="map"></div>
<script src="~/lib/jquery/dist/jquery.js"></script>
<style>
    #map {
        width: 100%;
        position: static !important;
        overflow: hidden !important;
    }


    .modal-dialog {
        width: 80%;
        height: 80vh;
        vertical-align: middle;
        margin: 5% 10% 10% 10%;
        padding: 0;
    }

    .modal-content {
        height: auto;
        min-height: 80vh;
        border-radius: 5px;
        vertical-align: middle;
        background-color: #242F3E;
        border-bottom: 0;
    }
</style>
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="border:0 !important;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3 style="color:white; text-align:center" class="modal-title">Modal Header</h3>
            </div>
            <div class="modal-body">
                @*<div id="chartContainer" style="height: auto;
                    min-height: 65vh;">*@
                <div class="row">
                    <div class="col-md-4">
                        <svg id="animated" viewbox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="#FDB900" />
                            <path id="progress" stroke-linecap="round" stroke-width="5" stroke="#fff" fill="none"
                                  d="M50 10
           a 40 40 0 0 1 0 80
           a 40 40 0 0 1 0 -80">
                            </path>
                            <text id="count1" x="50" y="50" text-anchor="middle" dy="7" font-size="20"></text>

                        </svg>
                        <div class="col-md-12">
                            <h1 style="color:white; text-align:center">Air Pollution</h1>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <svg id="animated" viewbox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="#FDB900" />
                            <path id="progress" stroke-linecap="round" stroke-width="5" stroke="#fff" fill="none"
                                  d="M50 10
           a 40 40 0 0 1 0 80
           a 40 40 0 0 1 0 -80">
                            </path>
                            <text id="count2" x="50" y="50" text-anchor="middle" dy="7" font-size="20">100%</text>
                        </svg>
                        <div class="col-md-12">
                            <h1 style="color:white; text-align:center">Wind Speed</h1>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <svg id="animated" viewbox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="#FDB900" />
                            <path id="progress" stroke-linecap="round" stroke-width="5" stroke="#fff" fill="none"
                                  d="M50 10
           a 40 40 0 0 1 0 80
           a 40 40 0 0 1 0 -80">
                            </path>
                            <text id="count3" x="50" y="50" text-anchor="middle" dy="7" font-size="20">100%</text>
                        </svg>
                        <div class="col-md-12">
                            <h1 style="color:white; text-align:center">Wind Direction</h1>
                        </div>
                    </div>
                    <div class="col-md-12 " data-dismiss="modal" style=" cursor:pointer;background-color:#FDB900;width:80% ;margin-left:10%;margin-right:10%; margin-top:5%; padding:15px;border-radius:10px;border:0; text-align:center;font-size:20px;">WARN AUTHORIES</div>
                </div>
            </div>
        </div>

    </div>

</div>


@section Scripts{
    <script src="~/js/echarts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.3.0/snap.svg-min.js"></script>
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 46.483, lng: 49.43 },
                zoom: 2,
                styles: [
                    { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },
                    { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },
                    { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },

                    {
                        featureType: 'road',
                        elementType: 'geometry',
                        stylers: [{ color: '#38414e' }]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry.stroke',
                        stylers: [{ color: '#212a37' }]
                    },
                    {
                        featureType: 'road',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#9ca5b3' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry',
                        stylers: [{ color: '#746855' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry.stroke',
                        stylers: [{ color: '#1f2835' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#f3d19c' }]
                    },

                    {
                        featureType: 'water',
                        elementType: 'geometry',
                        stylers: [{ color: '#17263c' }]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#515c6d' }]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.stroke',
                        stylers: [{ color: '#17263c' }]
                    },
                ]

            });
            var data = `[
                                            {
                                                "latitude": 46.485,
                                                "longitude": 49.417,
                                                "acq_date": 20181013,
                                                "acq_time": 2255,
                                                "brightness": 317.8,
                                                "daynight": "N",
                                                "bright_t31": 277.4,
                                                "version": "6.0NRT",
                                                "instrument": "MODIS",
                                                "frp": 19.8,
                                                "confidence": 76,
                                                "scan": 1,
                                                "track": 1,
                                                "satellite": "Hana"
                                            },
                                            {
                                                "latitude": 46.494,
                                                "longitude": 49.364,
                                                "acq_date": 20181013,
                                                "acq_time": 2255,
                                                "brightness": 324.3,
                                                "daynight": "N",
                                                "bright_t31": 277.4,
                                                "version": "6.0NRT",
                                                "instrument": "MODIS",
                                                "frp": 28,
                                                "confidence": 88,
                                                "scan": 1,
                                                "track": 1,
                                                "satellite": "Toka"
                                            }, {
                                                "latitude": 46.4854,
                                                "longitude": 49.1564,
                                                "acq_date": 20181013,
                                                "acq_time": 2255,
                                                "brightness": 317.8,
                                                "daynight": "N",
                                                "bright_t31": 277.4,
                                                "version": "6.0NRT",
                                                "instrument": "MODIS",
                                                "frp": 19.8,
                                                "confidence": 76,
                                                "scan": 1,
                                                "track": 1,
                                                "satellite": "Hana"
                                            }, {
                                                "latitude": 46.49679,
                                                "longitude": 49.1956,
                                                "acq_date": 20181013,
                                                "acq_time": 2255,
                                                "brightness": 317.8,
                                                "daynight": "N",
                                                "bright_t31": 277.4,
                                                "version": "6.0NRT",
                                                "instrument": "MODIS",
                                                "frp": 19.8,
                                                "confidence": 76,
                                                "scan": 1,
                                                "track": 1,
                                                "satellite": "Hana"
                                            }, {
                                                "latitude": 46.47679,
                                                "longitude": 49.3956,
                                                "acq_date": 20181013,
                                                "acq_time": 2255,
                                                "brightness": 317.8,
                                                "daynight": "N",
                                                "bright_t31": 277.4,
                                                "version": "6.0NRT",
                                                "instrument": "MODIS",
                                                "frp": 19.8,
                                                "confidence": 90,
                                                "scan": 1,
                                                "track": 1,
                                                "satellite": "Hana"
                                            },{
                        "latitude": 13.637,
                        "longitude": 40.796,
                        "acq_date": 20181013,
                        "acq_time": 2305,
                        "brightness": 342.3,
                        "daynight": "N",
                        "bright_t31": 310.7,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 49.3,
                        "confidence": 100,
                        "scan": 1.1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 19.002,
                        "longitude": 23.028,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 314,
                        "daynight": "N",
                        "bright_t31": 291.2,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 65.1,
                        "confidence": 88,
                        "scan": 3,
                        "track": 1.7,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 18.996,
                        "longitude": 22.999,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 301.3,
                        "daynight": "N",
                        "bright_t31": 291.2,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 22.6,
                        "confidence": 40,
                        "scan": 3,
                        "track": 1.7,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 19.005,
                        "longitude": 23.035,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 307.1,
                        "daynight": "N",
                        "bright_t31": 290.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 40.1,
                        "confidence": 70,
                        "scan": 3,
                        "track": 1.7,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 18.999,
                        "longitude": 23.007,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 308.5,
                        "daynight": "N",
                        "bright_t31": 291.6,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 44.8,
                        "confidence": 75,
                        "scan": 3,
                        "track": 1.7,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 19.985,
                        "longitude": 30.934,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 302.5,
                        "daynight": "N",
                        "bright_t31": 288.9,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 6,
                        "confidence": 49,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 19.347,
                        "longitude": 27.945,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 304.3,
                        "daynight": "N",
                        "bright_t31": 291,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 8.1,
                        "confidence": 59,
                        "scan": 1.3,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 19.339,
                        "longitude": 27.94,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 305.1,
                        "daynight": "N",
                        "bright_t31": 291.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 8.9,
                        "confidence": 63,
                        "scan": 1.3,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 18.967,
                        "longitude": 35.12,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 304.4,
                        "daynight": "N",
                        "bright_t31": 292.9,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 8.8,
                        "confidence": 60,
                        "scan": 1.3,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 17.936,
                        "longitude": 30.307,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 311.4,
                        "daynight": "N",
                        "bright_t31": 290,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 12.5,
                        "confidence": 82,
                        "scan": 1.1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 17.69,
                        "longitude": 30.622,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 311.8,
                        "daynight": "N",
                        "bright_t31": 287.3,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 13.6,
                        "confidence": 83,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 17.09,
                        "longitude": 29.102,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 304.6,
                        "daynight": "N",
                        "bright_t31": 293.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 7,
                        "confidence": 61,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.82,
                        "longitude": 29.467,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 301.7,
                        "daynight": "N",
                        "bright_t31": 291.2,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 6.2,
                        "confidence": 43,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.794,
                        "longitude": 29.367,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 308.1,
                        "daynight": "N",
                        "bright_t31": 292.5,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 10.9,
                        "confidence": 74,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 17.127,
                        "longitude": 33.228,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 317.5,
                        "daynight": "N",
                        "bright_t31": 293.7,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 15.7,
                        "confidence": 95,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.535,
                        "longitude": 29.911,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 304.3,
                        "daynight": "N",
                        "bright_t31": 292.9,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 6.9,
                        "confidence": 59,
                        "scan": 1.1,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.533,
                        "longitude": 29.901,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 306.4,
                        "daynight": "N",
                        "bright_t31": 292.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 8.7,
                        "confidence": 68,
                        "scan": 1.1,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.531,
                        "longitude": 29.908,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 313.3,
                        "daynight": "N",
                        "bright_t31": 293.1,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 13.7,
                        "confidence": 87,
                        "scan": 1.1,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.511,
                        "longitude": 29.965,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 305,
                        "daynight": "N",
                        "bright_t31": 294.3,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 6.7,
                        "confidence": 62,
                        "scan": 1.1,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.479,
                        "longitude": 30.234,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 304.2,
                        "daynight": "N",
                        "bright_t31": 292.7,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 6.3,
                        "confidence": 59,
                        "scan": 1.1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.264,
                        "longitude": 29.448,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 321,
                        "daynight": "N",
                        "bright_t31": 296.1,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 20.2,
                        "confidence": 100,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.263,
                        "longitude": 29.437,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 326.1,
                        "daynight": "N",
                        "bright_t31": 296.6,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 27.9,
                        "confidence": 100,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.261,
                        "longitude": 29.426,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 307.6,
                        "daynight": "N",
                        "bright_t31": 294.9,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 7.3,
                        "confidence": 7,
                        "scan": 1.2,
                        "track": 1.1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.518,
                        "longitude": 31.326,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 300.7,
                        "daynight": "N",
                        "bright_t31": 289.8,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 4.6,
                        "confidence": 31,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 16.509,
                        "longitude": 31.327,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 302.5,
                        "daynight": "N",
                        "bright_t31": 289.8,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 5.6,
                        "confidence": 49,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Aqua"
                    },
                    {
                        "latitude": 15.914,
                        "longitude": 30.804,
                        "acq_date": 20181013,
                        "acq_time": 2315,
                        "brightness": 311.9,
                        "daynight": "N",
                        "bright_t31": 297.1,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 9.5,
                        "confidence": 81,
                        "scan": 1.1,
                        "track": 1,
                        "satellite": "Aqua"
                    }

                                            ]`;
            var infowindow = new google.maps.InfoWindow({

            });
            $.each(JSON.parse(data), function (index, value) {

                var myLatlng = new google.maps.LatLng(value.latitude, value.longitude);
                //alert(myLatlng/*);*/
                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                });

                var redCircle = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 1,
                    strokeWeight: 1,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: map,
                    center: { lat: value.latitude, lng: value.longitude },
                    radius: value.confidence * 5.5
                });
                if (value.confidence > 0 && value.confidence <= 40) {
                    redCircle.strokeColor = "#ffd11a";
                    redCircle.fillColor = "#ffd11a";

                }
                if (value.confidence > 40 && value.confidence <= 70) {
                    redCircle.strokeColor = "#ff6600";
                    redCircle.fillColor = "#ff6600"; 
                }
                else {
                    redCircle.strokeColor = "#ff0000";
                    redCircle.fillColor = "#ff0000"; 
                }
                //alert(redCircle.radius);
                //var greenCircle = new google.maps.Circle({
                //    strokeColor: '#33cc33',
                //    strokeOpacity: 0.8,
                //    strokeWeight: 2,
                //    fillColor: '#FFFF00',
                //    fillOpacity: 0.35,
                //    map: map,
                //    center: { lat: value.latitude, lng: value.longitude },
                //    radius: value.confidence * 10 + 100
                //});
                bindInfoWindow(marker, map, infowindow, "", value.latitude, value.longitude);
            });
        }
        function bindInfoWindow(marker, map, infowindow, divi, lat, lng) {
            marker.addListener('click', function () {
                $('#myModal').modal('show');
                showChart(lat, lng);

            });
            //marker.addListener('mouseover', function () {
            ////    infowindow.setContent(divi);
            ////    infowindow.open(map, this);
            ////});

        }

        var count = $(('#count'));
        $({ Counter: 0 }).animate({ Counter: count.text() }, {

            easing: 'linear',
            step: function () {
                count.text(Math.ceil(Math.floor((Math.random() * 100) + 1)) + "%");
            }
        });

        var s = Snap('#animated');
        var progress = s.select('#progress');

        progress.attr({ strokeDasharray: '0, 251.2' });
        Snap.animate(0, 251.2, function (value) {
            progress.attr({ 'stroke-dasharray': value + ',251.2' });
        }, 0);

        function showChart(lat, lng) {
            var drejtimi = ['N', 'NE', 'W', 'E', 'SE', 'S', 'SW', 'NW'];
            $("#count1").text(Math.ceil(Math.floor((Math.random() * 200) + 1)) + "ppb");
            $("#count2").text(Math.ceil(Math.floor((Math.random() * 50) + 1)) + "km/h");
            $("#count3").text(drejtimi[Math.floor(Math.random() * drejtimi.length)]);
            $('.modal-title').text(lat + "º , " + lng + "º");
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDfytPh8CfSlcmsoCWeoDZlO0ddKNy7mM&callback=initMap"
            type="text/javascript"></script>
}
