
@{
    ViewData["Title"] = "Map";
}

<div id="map"></div>
<script src="~/lib/jquery/dist/jquery.js"></script>
<style>
    #map {
        width: 100%;
        
        position: static !important;
        overflow: hidden !important;
    }


    .modal-dialog {
        width: 80%;
        height: 80vh;
        vertical-align: middle;
        margin: 5% 10% 10% 10%;
        padding: 0;
    }

    .modal-content {
        height: auto;
        min-height: 80vh;
        border-radius: 5px;
        vertical-align: middle;
        background-color: #242F3E;
        border-bottom:0;
    }
    .modal-body {
        display: flex;
        flex-wrap: wrap-reverse;
    }

</style>
<div id="myModal" class="modal fade" role="dialog" >
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content" >
            <div class="modal-header" style="border:0 !important;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" >
                <div style="height: auto; min-height: 65vh; float:left;">
                    <div id="chartContainer" style="height: auto; min-height: 65vh; "></div>
                </div>
                <div style="height: auto; min-height: 65vh; float:right; margin-right:10%;">
                    <div id="chartContainer2" style="height: auto; min-height: 65vh; "></div>
                </div>
                
               
            </div>
         
        </div>

    </div>
</div>

@section Scripts{
    <script src="~/js/echarts.js"></script>
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 46.483, lng: 49.43 },
                zoom: 10,
                styles: [
                    { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },
                    { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },
                    { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },

                    {
                        featureType: 'road',
                        elementType: 'geometry',
                        stylers: [{ color: '#38414e' }]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry.stroke',
                        stylers: [{ color: '#212a37' }]
                    },
                    {
                        featureType: 'road',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#9ca5b3' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry',
                        stylers: [{ color: '#746855' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry.stroke',
                        stylers: [{ color: '#1f2835' }]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#f3d19c' }]
                    },

                    {
                        featureType: 'water',
                        elementType: 'geometry',
                        stylers: [{ color: '#17263c' }]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#515c6d' }]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.stroke',
                        stylers: [{ color: '#17263c' }]
                    }
                ]

            });
            var data = `[
                    {
                        "latitude": 46.485,
                        "longitude": 49.417,
                        "acq_date": 20181013,
                        "acq_time": 2255,
                        "brightness": 317.8,
                        "daynight": "N",
                        "bright_t31": 277.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 19.8,
                        "confidence": 76,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Hana"
                    },
                    {
                        "latitude": 46.494,
                        "longitude": 49.364,
                        "acq_date": 20181013,
                        "acq_time": 2255,
                        "brightness": 324.3,
                        "daynight": "N",
                        "bright_t31": 277.4,
                        "version": "6.0NRT",
                        "instrument": "MODIS",
                        "frp": 28,
                        "confidence": 88,
                        "scan": 1,
                        "track": 1,
                        "satellite": "Toka"
                    }
                    ]`;
            var infowindow = new google.maps.InfoWindow({

            });
            $.each(JSON.parse(data), function (index, value) {

                var myLatlng = new google.maps.LatLng(value.latitude, value.longitude);
                //alert(myLatlng/*);*/
                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                });

                var redCircle = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 1,
                    strokeWeight: 1,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: map,
                    center: { lat: value.latitude, lng: value.longitude },
                    radius: value.confidence * 5.5
                });
                //alert(redCircle.radius);
                //var greenCircle = new google.maps.Circle({
                //    strokeColor: '#33cc33',
                //    strokeOpacity: 0.8,
                //    strokeWeight: 2,
                //    fillColor: '#FFFF00',
                //    fillOpacity: 0.35,
                //    map: map,
                //    center: { lat: value.latitude, lng: value.longitude },
                //    radius: value.confidence * 10 + 100
                //});
                bindInfoWindow(marker, map, infowindow, "");
            });
        }
        function bindInfoWindow(marker, map, infowindow, divi) {
            marker.addListener('click', function () {
                $('#myModal').modal('show');
                showChart();
                showChart2()
            });
            //marker.addListener('mouseover', function () {
            ////    infowindow.setContent(divi);
            ////    infowindow.open(map, this);
            ////});

        }
        function showChart() {
            var options = {
                animationEnabled: true,
                title: {
                    text: "Spot"
                },
                axisX: {
                    valueFormatString: "MMM"
                },
                axisY: {
                    title: "Sales (in USD)",
                    prefix: "$",
                    includeZero: false
                },
                data: [{
                    yValueFormatString: "$#,###",
                    xValueFormatString: "MMMM",
                    type: "spline",
                    dataPoints: [
                        { x: new Date(2017, 0), y: 25060 },
                        { x: new Date(2017, 1), y: 27980 },
                        { x: new Date(2017, 2), y: 33800 },
                        { x: new Date(2017, 3), y: 49400 },
                        { x: new Date(2017, 4), y: 40260 },
                        { x: new Date(2017, 5), y: 33900 },
                        { x: new Date(2017, 6), y: 48000 },
                        { x: new Date(2017, 7), y: 31500 },
                        { x: new Date(2017, 8), y: 32300 },
                        { x: new Date(2017, 9), y: 42000 },
                        { x: new Date(2017, 10), y: 52160 },
                        { x: new Date(2017, 11), y: 49400 }
                    ]
                }]
            };
            $("#chartContainer").CanvasJSChart(options);

        
//            var data =`[
//    ["Country","Brezometer AQI","Unit","Concentration"],
//    [
//            "China",
//             85,
//            "ppb",
//             285.4
//            ]
//            ,

//    [
//        "Japan",
//         91,
//        "ppb",
//         258
//        ],
//        [
//            "Australia",
//             68,
//            "ppb",
//             269.27
//            ]
    
//]`
//                var myChart = echarts.init(document.getElementById('chartContainer'))
//                var sizeValue = '57%';
//                var symbolSize = 2.5;
//                option = {
//                    legend: {},
//                    tooltip: {},
//                    toolbox: {
//                        left: 'center',
//                        feature: {
//                            dataZoom: {}
//                        }
//                    },
//                    grid: [
//                        { right: sizeValue, bottom: sizeValue },
//                        { left: sizeValue, bottom: sizeValue },
//                        { right: sizeValue, top: sizeValue },
//                        { left: sizeValue, top: sizeValue }
//                    ],
//                    xAxis: [
//                        { type: 'value', gridIndex: 0, name: 'Brezometer AQI', axisLabel: { rotate: 50, interval: 0 } },
//                        { type: 'category', gridIndex: 1, name: 'Country', boundaryGap: false, axisLabel: { rotate: 50, interval: 0 } },
//                        { type: 'value', gridIndex: 2, name: 'Country', axisLabel: { rotate: 50, interval: 0 } },
//                        { type: 'value', gridIndex: 3, name: 'Concentration', axisLabel: { rotate: 50, interval: 0 } }
//                    ],
//                    yAxis: [
//                        { type: 'value', gridIndex: 0, name: 'Unit' },
//                        { type: 'value', gridIndex: 1, name: 'Brezometer AQI' },
//                        { type: 'value', gridIndex: 2, name: 'Concentration' },
//                        { type: 'value', gridIndex: 3, name: 'Unit' }
//                    ],
//                    dataset: {
//                        dimensions: [
//                            'Country',
//                            'Brezometer AQI',
//                            'Unit',
//                            'Concentration',
                            
//                        ],
//                        source: JSON.parse(data)
//                    },
//                    series: [
//                        {
//                            type: 'scatter',
//                            symbolSize: symbolSize,
//                            xAxisIndex: 0,
//                            yAxisIndex: 0,
//                            encode: {
//                                x: 'Brezometer AQI',
//                                y: 'Unit',
//                                tooltip: [0, 1, 2, 3]
//                            }
//                        },
//                        {
//                            type: 'scatter',
//                            symbolSize: symbolSize,
//                            xAxisIndex: 1,
//                            yAxisIndex: 1,
//                            encode: {
//                                x: 'Country',
//                                y: 'Brezometer AQI',
//                                tooltip: [0, 1, 2, 3]
//                            }
//                        },
//                        {
//                            type: 'scatter',
//                            symbolSize: symbolSize,
//                            xAxisIndex: 2,
//                            yAxisIndex: 2,
//                            encode: {
//                                x: 'Country',
//                                y: 'Concentration',
//                                tooltip: [0, 1, 2, 3]
//                            }
//                        },
//                        {
//                            type: 'scatter',
//                            symbolSize: symbolSize,
//                            xAxisIndex: 3,
//                            yAxisIndex: 3,
//                            encode: {
//                                x: 'Concentration',
//                                y: 'Unit',
//                                tooltip: [0, 1, 2, 3]
//                            }
//                        }
//                    ]
//                };

//                myChart.setOption(option);

        }

        function showChart2() {
            var options = {
                animationEnabled: true,
                title: {
                    text: "Spot"
                },
                axisX: {
                    valueFormatString: "MMM"
                },
                axisY: {
                    title: "Sales (in USD)",
                    prefix: "$",
                    includeZero: false
                },
                data: [{
                    yValueFormatString: "$#,###",
                    xValueFormatString: "MMMM",
                    type: "spline",
                    dataPoints: [
                        { x: new Date(2017, 0), y: 25060 },
                        { x: new Date(2017, 1), y: 27980 },
                        { x: new Date(2017, 2), y: 33800 },
                        { x: new Date(2017, 3), y: 49400 },
                        { x: new Date(2017, 4), y: 40260 },
                        { x: new Date(2017, 5), y: 33900 },
                        { x: new Date(2017, 6), y: 48000 },
                        { x: new Date(2017, 7), y: 31500 },
                        { x: new Date(2017, 8), y: 32300 },
                        { x: new Date(2017, 9), y: 42000 },
                        { x: new Date(2017, 10), y: 52160 },
                        { x: new Date(2017, 11), y: 49400 }
                    ]
                }]
            };
            $("#chartContainer2").CanvasJSChart(options);

        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDfytPh8CfSlcmsoCWeoDZlO0ddKNy7mM&callback=initMap"
            type="text/javascript"></script>
}
